{"version":3,"file":"utils.js","sources":["../../src/utils.ts"],"sourcesContent":["\r\nimport TomSelect from './tom-select';\r\nimport { TomLoadCallback } from './types/index';\r\n\r\n\r\n/**\r\n * Converts a scalar to its best string representation\r\n * for hash keys and HTML attribute values.\r\n *\r\n * Transformations:\r\n *   'str'     -> 'str'\r\n *   null      -> ''\r\n *   undefined -> ''\r\n *   true      -> '1'\r\n *   false     -> '0'\r\n *   0         -> '0'\r\n *   1         -> '1'\r\n *\r\n */\r\nexport const hash_key = (value:undefined|null|boolean|string|number):string|null => {\r\n\tif (typeof value === 'undefined' || value === null) return null;\r\n\treturn get_hash(value);\r\n};\r\n\r\nexport const get_hash = (value:boolean|string|number):string => {\r\n\tif (typeof value === 'boolean') return value ? '1' : '0';\r\n\treturn value + '';\r\n};\r\n\r\n/**\r\n * Escapes a string for use within HTML.\r\n *\r\n */\r\nexport const escape_html = (str:string):string => {\r\n\treturn (str + '')\r\n\t\t.replace(/&/g, '&amp;')\r\n\t\t.replace(/</g, '&lt;')\r\n\t\t.replace(/>/g, '&gt;')\r\n\t\t.replace(/\"/g, '&quot;');\r\n};\r\n\r\n\r\n/**\r\n * use setTimeout if timeout > 0 \r\n */\r\nexport const timeout = (fn:()=>void,timeout:number) => {\r\n\tif( timeout > 0 ){\r\n\t\treturn setTimeout(fn,timeout);\r\n\t}\r\n\r\n\tfn.call(null);\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * Debounce the user provided load function\r\n *\r\n */\r\nexport const loadDebounce = (fn:(value:string,callback:TomLoadCallback) => void,delay:number) => {\r\n\tvar timeout: null|ReturnType<typeof setTimeout>;\r\n\treturn function(this:TomSelect, value:string,callback:TomLoadCallback) {\r\n\t\tvar self = this;\r\n\r\n\t\tif( timeout ){\r\n\t\t\tself.loading = Math.max(self.loading - 1, 0);\r\n\t\t\tclearTimeout(timeout);\r\n\t\t}\r\n\t\ttimeout = setTimeout(function() {\r\n\t\t\ttimeout = null;\r\n\t\t\tself.loadedSearches[value] = true;\r\n\t\t\tfn.call(self, value, callback);\r\n\r\n\t\t}, delay);\r\n\t};\r\n};\r\n\r\n\r\n/**\r\n * Debounce all fired events types listed in `types`\r\n * while executing the provided `fn`.\r\n *\r\n */\r\nexport const debounce_events = ( self:TomSelect, types:string[], fn:() => void ) => {\r\n\tvar type:string;\r\n\tvar trigger = self.trigger;\r\n\tvar event_args:{ [key: string]: any } = {};\r\n\r\n\t// override trigger method\r\n\tself.trigger = function(){\r\n\t\tvar type = arguments[0];\r\n\t\tif (types.indexOf(type) !== -1) {\r\n\t\t\tevent_args[type] = arguments;\r\n\t\t} else {\r\n\t\t\treturn trigger.apply(self, arguments);\r\n\t\t}\r\n\t};\r\n\r\n\t// invoke provided function\r\n\tfn.apply(self, []);\r\n\tself.trigger = trigger;\r\n\r\n\t// trigger queued events\r\n\tfor( type of types ){\r\n\t\tif( type in event_args ){\r\n\t\t\ttrigger.apply(self, event_args[type]);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * Determines the current selection within a text input control.\r\n * Returns an object containing:\r\n *   - start\r\n *   - length\r\n *\r\n * Note: \"selectionStart, selectionEnd ... apply only to inputs of types text, search, URL, tel and password\"\r\n * \t- https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setSelectionRange\r\n */\r\nexport const getSelection = (input:HTMLInputElement):{ start: number; length: number } => {\r\n\treturn {\r\n\t\tstart\t: input.selectionStart || 0,\r\n\t\tlength\t: (input.selectionEnd||0) - (input.selectionStart||0),\r\n\t};\r\n};\r\n\r\n\r\n/**\r\n * Prevent default\r\n *\r\n */\r\nexport const preventDefault = (evt?:Event, stop:boolean=false):void => {\r\n\tif( evt ){\r\n\t\tevt.preventDefault();\r\n\t\tif( stop ){\r\n\t\t\tevt.stopPropagation();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Add event helper\r\n *\r\n */\r\nexport const addEvent = (target:EventTarget, type:string, callback:EventListenerOrEventListenerObject, options?:object):void => {\r\n\ttarget.addEventListener(type,callback,options);\r\n};\r\n\r\n\r\n/**\r\n * Return true if the requested key is down\r\n * Will return false if more than one control character is pressed ( when [ctrl+shift+a] != [ctrl+a] )\r\n * The current evt may not always set ( eg calling advanceSelection() )\r\n *\r\n */\r\nexport const isKeyDown = ( key_name:keyof (KeyboardEvent|MouseEvent), evt?:KeyboardEvent|MouseEvent ) => {\r\n\r\n\tif( !evt ){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif( !evt[key_name] ){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar count = (evt.altKey?1:0) + (evt.ctrlKey?1:0) + (evt.shiftKey?1:0) + (evt.metaKey?1:0);\r\n\r\n\tif( count === 1 ){\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * Get the id of an element\r\n * If the id attribute is not set, set the attribute with the given id\r\n *\r\n */\r\nexport const getId = (el:Element,id:string) => {\r\n\tconst existing_id = el.getAttribute('id');\r\n\tif( existing_id ){\r\n\t\treturn existing_id;\r\n\t}\r\n\r\n\tel.setAttribute('id',id);\r\n\treturn id;\r\n};\r\n\r\n\r\n/**\r\n * Returns a string with backslashes added before characters that need to be escaped.\r\n */\r\nexport const addSlashes = (str:string):string => {\r\n\treturn str.replace(/[\\\\\"']/g, '\\\\$&');\r\n};\r\n\r\n/**\r\n *\r\n */\r\nexport const append = ( parent:Element|DocumentFragment, node: string|Node|null|undefined ):void =>{\r\n\tif( node ) parent.append(node);\r\n};\r\n"],"names":["hash_key","value","get_hash","escape_html","str","replace","timeout","fn","setTimeout","call","loadDebounce","delay","callback","self","loading","Math","max","clearTimeout","loadedSearches","debounce_events","types","type","trigger","event_args","arguments","indexOf","apply","getSelection","input","start","selectionStart","length","selectionEnd","preventDefault","evt","stop","stopPropagation","addEvent","target","options","addEventListener","isKeyDown","key_name","count","altKey","ctrlKey","shiftKey","metaKey","getId","el","id","existing_id","getAttribute","setAttribute","addSlashes","append","parent","node"],"mappings":"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"}